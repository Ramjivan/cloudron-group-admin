<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

    <!-- Dashboard View -->
    <div id="dashboard-view">
        <header>
            <h1 id="dashboard-title">User Management</h1>
            <div>
                <button id="add-new-btn">Add New...</button>
            </div>
        </header>

        <main class="container">
            <!-- User List -->
            <div class="card">
                <h3>Group Users</h3>
                <table id="user-list">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Display Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Edit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Mailbox List -->
            <div class="card">
                <h3>Mailboxes</h3>
                <table id="mailbox-list">
                    <thead>
                        <tr>
                            <th>Address</th>
                            <th>Owner</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </main>

        <footer>
            <p id="copyright"></p>
        </footer>

    <!-- Creation Modal -->
    <div id="creation-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" id="close-creation-modal">&times;</span>
            <div class="tabs">
                <button class="tab-link active" data-tab="add-user-tab">Add User</button>
                <button class="tab-link" data-tab="add-mailbox-tab">Add Mailbox</button>
            </div>

            <!-- Add User Tab -->
            <div id="add-user-tab" class="tab-content active">
                <h3>Add New User</h3>
                <form id="add-user-form">
                    <input type="text" id="new-username" placeholder="Username" required>
                    <input type="text" id="new-displayname" placeholder="Display Name" required>
                    <div class="password-wrapper">
                        <input type="password" id="new-password-user" placeholder="Password" required>
                        <button type="button" class="password-tool-btn view-password" data-target="new-password-user">üëÅÔ∏è</button>
                        <button type="button" class="password-tool-btn copy-password" data-target="new-password-user">üìã</button>
                        <button type="button" id="generate-password-add" class="secondary">Generate</button>
                    </div>
                    <input type="password" id="confirm-password-user" placeholder="Confirm Password" required>
                    <input type="email" id="new-primary-email" placeholder="Primary Email" required>
                    <input type="email" id="recovery-email" placeholder="Recovery Email (Optional)">
                    <div class="checkbox-group">
                        <input type="checkbox" id="create-mailbox-checkbox" checked>
                        <label for="create-mailbox-checkbox">Create default mailbox</label>
                    </div>
                    <div id="mailbox-name-wrapper">
                        <input type="text" id="new-mailbox-name-user" placeholder="Mailbox name (defaults to username)">
                    </div>
                    <button type="submit">Create User</button>
                    <p id="add-user-error" class="error-message"></p>
                </form>
            </div>

            <!-- Add Mailbox Tab -->
            <div id="add-mailbox-tab" class="tab-content">
                <h3>Add New Mailbox</h3>
                <form id="add-mailbox-form">
                    <div class="email-field">
                        <input type="text" id="new-mailbox-name" placeholder="Mailbox name" required>
                        <span>@</span>
                        <select id="new-mailbox-domain" required></select>
                    </div>
                    <select id="new-mailbox-owner" required>
                        <option value="" disabled selected>Select owner</option>
                    </select>
                    <button type="submit">Create Mailbox</button>
                    <p id="add-mailbox-error" class="error-message"></p>
                    <p id="mailbox-check-message" class="info-message"></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" id="close-edit-user-modal">&times;</span>
            <h3>Edit User</h3>
            <form id="edit-user-form">
                <input type="hidden" id="edit-user-id">
                <label for="edit-displayname">Display Name</label>
                <input type="text" id="edit-displayname" required>
                
                <label for="edit-primary-email">Primary Email</label>
                <input type="email" id="edit-primary-email" required>

                <label for="edit-recovery-email">Recovery Email</label>
                <input type="email" id="edit-recovery-email">

                <button type="submit">Save Changes</button>
                <p id="edit-user-error" class="error-message"></p>
            </form>
        </div>
    </div>

    <!-- Log Modal -->
    <div id="log-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" id="close-log-modal">&times;</span>
            <div class="tabs">
                <button class="tab-link active" data-tab="audit-log-tab">Audit Logs</button>
                <button class="tab-link" data-tab="password-log-tab">Stored Passwords</button>
            </div>
            <div id="audit-log-tab" class="tab-content active">
                <h2>Audit Logs</h2>
                <div id="log-content"></div>
            </div>
            <div id="password-log-tab" class="tab-content">
                <h2>Stored Passwords</h2>
                <div id="password-log-content"></div>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="reset-password-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" id="close-reset-modal">&times;</span>
            <h2>Set New Password</h2>
            <p>Set a new password for the user directly.</p>
            <div class="card">
                <form id="set-password-form">
                    <div class="password-wrapper">
                        <input type="password" id="new-password" placeholder="New Password" required>
                        <button type="button" class="password-tool-btn view-password" data-target="new-password">üëÅÔ∏è</button>
                        <button type="button" class="password-tool-btn copy-password" data-target="new-password">üìã</button>
                        <button type="button" id="generate-password-reset" class="secondary">Generate</button>
                    </div>
                    <input type="password" id="confirm-password" placeholder="Confirm Password" required>
                    <button type="submit">Set Password</button>
                    <p id="set-password-error" class="error-message"></p>
                </form>
            </div>
        </div>
    </div>

    <!-- View Password Modal -->
    <div id="view-password-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" id="close-view-password-modal">&times;</span>
            <h2>User Password</h2>
            <div class="card">
                <p><strong>Username:</strong> <span id="view-password-username"></span></p>
                <p><strong>Password:</strong> <span id="view-password-text"></span></p>
                <button id="copy-viewed-password">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script src="/script.js"></script>
</body>
</html>
